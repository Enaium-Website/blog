<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Minecraft启动器开发#3下载游戏</title><link rel=stylesheet href=/css/bootstrap.min.css></head><body class="d-flex flex-column justify-content-between min-vh-100"><nav class="navbar navbar-expand-lg bg-light"><div class=container-fluid><a class=navbar-brand href=/><img src=https://simpleicons.org/icons/github.svg alt=Logo width=30 height=24 class="d-inline-block align-text-top">
Enaium's Blog</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/contact/>Contact</a></li><li class=nav-item><a class=nav-link aria-current=page href=https://blog.enaium.cn/about/>About</a></li></ul></div></div></nav><div style=flex:1><div class=container><div class=card><div class=card-header>Minecraft启动器开发#3下载游戏</div><div class=card-body><div class=card-text><p><code>gameVersion</code>改为<code>titleVersion</code></p><p><code>var gameVersion = "1.8.9";</code>声明变量，指定游戏版本</p><p>引入<code>commons-io</code>和<code>gson</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>commons-io<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>commons-io<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>2.8.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>com.google.code.gson<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>gson<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>2.8.6<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>读取游戏列表访问<code>https://launchermeta.mojang.com/mc/game/version_manifest_v2.json</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>var gson <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Gson<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        var gameListJson <span style=color:#f92672>=</span> IOUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> URL<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;https://launchermeta.mojang.com/mc/game/version_manifest_v2.json&#34;</span><span style=color:#f92672>),</span> StandardCharsets<span style=color:#f92672>.</span><span style=color:#a6e22e>UTF_8</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        var gameList <span style=color:#f92672>=</span> gson<span style=color:#f92672>.</span><span style=color:#a6e22e>fromJson</span><span style=color:#f92672>(</span>gameListJson<span style=color:#f92672>,</span> JsonObject<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>).</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;versions&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getAsJsonArray</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        var gameJsonURL <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>JsonElement jsonElement <span style=color:#f92672>:</span> gameList<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>jsonElement<span style=color:#f92672>.</span><span style=color:#a6e22e>getAsJsonObject</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getAsString</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>gameVersion<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                gameJsonURL <span style=color:#f92672>=</span> jsonElement<span style=color:#f92672>.</span><span style=color:#a6e22e>getAsJsonObject</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;url&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getAsString</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>gameJsonURL<span style=color:#f92672>.</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>gameVersion <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; Not Found!&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>获取<code>versions</code>遍历出所以版本，之后获取指定版本的<code>json</code></p><p>如果没找到版本就抛出异常</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>var gameJson <span style=color:#f92672>=</span> gson<span style=color:#f92672>.</span><span style=color:#a6e22e>fromJson</span><span style=color:#f92672>(</span>IOUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> URL<span style=color:#f92672>(</span>gameJsonURL<span style=color:#f92672>),</span> StandardCharsets<span style=color:#f92672>.</span><span style=color:#a6e22e>UTF_8</span><span style=color:#f92672>),</span> JsonObject<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>var gameJarUrl <span style=color:#f92672>=</span> gameJson<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;downloads&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getAsJsonObject</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;client&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getAsJsonObject</span><span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;url&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>getAsString</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><p>获取jar文件的url</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>var versionsDir <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>gameDir<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;versions&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>versionsDir<span style=color:#f92672>.</span><span style=color:#a6e22e>exists</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    versionsDir<span style=color:#f92672>.</span><span style=color:#a6e22e>mkdir</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>var versionDir <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>versionsDir<span style=color:#f92672>,</span> gameVersion<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>versionDir<span style=color:#f92672>.</span><span style=color:#a6e22e>exists</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    versionDir<span style=color:#f92672>.</span><span style=color:#a6e22e>mkdir</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>var gameJarFile <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>versionDir<span style=color:#f92672>,</span>gameVersion <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.jar&#34;</span><span style=color:#f92672>);</span>
</span></span></code></pre></div><p>获取本地的Jar路径</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>gameJarFile<span style=color:#f92672>.</span><span style=color:#a6e22e>exists</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    FileUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>writeByteArrayToFile</span><span style=color:#f92672>(</span>gameJarFile<span style=color:#f92672>,</span> IOUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>toByteArray</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> URL<span style=color:#f92672>(</span>gameJarUrl<span style=color:#f92672>)));</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>如果没有这个文件那么就下载</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>var gameDir <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;.&#34;</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;.minecraft&#34;</span><span style=color:#f92672>);</span>
</span></span></code></pre></div><p>修改游戏目录为当前目录下的<code>.minecraft</code></p></div><div class="d-flex justify-content-between"><a class=text-reset href=https://blog.enaium.cn/post/2021-5-15-minecraft%E5%90%AF%E5%8A%A8%E5%99%A8%E5%BC%80%E5%8F%91%232%E5%90%AF%E5%8A%A8%E6%B8%B8%E6%88%8F/>Minecraft启动器开发#2启动游戏</a>
<a class=text-reset href=https://blog.enaium.cn/post/2021-5-15-minecraft%E5%90%AF%E5%8A%A8%E5%99%A8%E5%BC%80%E5%8F%91%234%E4%B8%8B%E8%BD%BD%E5%BA%93/>Minecraft启动器开发#4下载库</a></div></div></div></div></div><footer class="p-5 bg-dark text-white text-center"><div class=container><p class=lead>Copyright &copy; 2022 Enaium</p></div></footer><script src=/js/bootstrap.bundle.min.js></script></body></html>